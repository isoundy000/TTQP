{"version":3,"sources":["manageListScript.js"],"names":["cc","Class","extends","Component","properties","manageListContentView","Node","managePlayerItem","Prefab","setManageGoldLab","Label","setCompensateGoldLab","cancelManageBox","addBtn1","Button","subBtn1","addBtn2","subBtn2","zdpdIcon","Sprite","sqdjIcon","setManageGold","setCompensateGold","manageRoleIdArr","isAutoApplyFor","onLoad","onfire","on","jajaleManagePlayerListMessage","bind","jajaleApplyForManageMessage","jajaleAutoQueueMessage","node","EventType","TOUCH_END","event","active","string","ttqp_global","unitConversion","jajale","enterRoomData","isManage","onCloseManageListBox","onSQDJHandle","play","console","log","indexOf","currentUserInfo","roleId","bossId","dragInGold","length","p","roomType","scn","socket","send","str","getComponent","setHintText","onSetGoldHandle","customData","onZDPDHandle","data","self","removeAllChildren","isAutoList","file","zdpdText","loader","loadRes","SpriteAtlas","err","atlas","frame","getSpriteFrame","spriteFrame","list","bossList","index","item","instantiate","addChild","initManageListItem","push","setTimeout","SpriteFrame","url","raw"],"mappings":"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","file":"manageListScript.js","sourceRoot":"../../../../../../assets/Script/jajaleScript/manageList","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 当家列表 content view\n        manageListContentView: cc.Node,\n        // 当家列表 item\n        managePlayerItem: cc.Prefab,\n        // 设置当家金币 lab\n        setManageGoldLab: cc.Label,\n        // 设置当家赔付金币 lab\n        setCompensateGoldLab: cc.Label,\n        // \n        cancelManageBox: cc.Node,\n\n\n        // 设置当家金币 +号按钮\n        addBtn1: cc.Button,\n        // 设置当家金币 -号按钮\n        subBtn1: cc.Button,\n        // 设置当家赔付金币 +号按钮\n        addBtn2: cc.Button,\n        // 设置当家赔付金币 -号按钮\n        subBtn2: cc.Button,\n        // 自动排队 icon\n        zdpdIcon: cc.Sprite,\n        // 申请当家文字 icon\n        sqdjIcon: cc.Sprite,\n\n        // 当家金币\n        setManageGold: 100000000,\n        // 当家赔付金币\n        setCompensateGold: 100000000,\n        // 排队roleID数组\n        manageRoleIdArr: [],\n        // 是否自动排队\n        isAutoApplyFor: false,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        // 当家玩家列表\n        onfire.on('jajaleManagePlayerListMessage', this.jajaleManagePlayerListMessage.bind(this));\n        // 申请当家\n        onfire.on('jajaleApplyForManageMessage', this.jajaleApplyForManageMessage.bind(this));\n        // 自动排队\n        onfire.on('jajaleAutoQueueMessage', this.jajaleAutoQueueMessage.bind(this));\n        \n\n        this.node.on(cc.Node.EventType.TOUCH_END, function(event) { this.node.active = false; }, this);\n\n        // 百家厅 默认值\n        this.setManageGoldLab.string = ttqp_global.unitConversion(this.setManageGold);\n        this.setCompensateGoldLab.string = ttqp_global.unitConversion(this.setCompensateGold);\n\n        // 当前玩家是否当家\n        cc.jajale.enterRoomData.isManage = false;\n    },\n    /**\n     * 关闭弹窗\n     */\n    onCloseManageListBox: function() {\n        this.node.active = false;\n    },\n    /**\n     * 申请当家\n     */\n    onSQDJHandle: function() {\n        if (!cc.jajale.play) {\n            console.log('需要坐下才可以操作');\n            return;\n        }\n        console.log('申请当家');\n\n        if (this.manageRoleIdArr.indexOf(ttqp_global.currentUserInfo.roleId) == -1) {\n            // 不在排队列表\n            if (ttqp_global.currentUserInfo.roleId === cc.jajale.enterRoomData.bossId) {\n                console.log('您已经在当家状态，不可申请');\n                return;\n            }\n            // else if (this.manageRoleIdArr.indexOf(ttqp_global.currentUserInfo.roleId) != -1) {\n            //     console.log('您已经在排队状态，不可申请');\n            //     return;\n            // }\n            else if (cc.jajale.enterRoomData.dragInGold < 100000000) {\n                console.log('金币不足1亿，不能申请');\n                return;\n            }\n            else if (this.manageRoleIdArr.length >= 500) {\n                console.log('排队人数已满500，不可申请');\n                return;\n            }\n            else {\n            /**\n             * roomType:(int)//是1百家厅，2是朋友厅\n             * bossGold(int):当家金币，玩家拿出多少钱去当庄\n             * payBet(int):赔付金额， 一把玩家最多赔付多少\n             */\n            var p = {\n                'roomType' : cc.jajale.enterRoomData.roomType,\n                'bossGold' : this.setManageGold,\n                'payBet' : this.setCompensateGold,\n            }\n            cc.scn.socket.send(112210,p);\n            }\n            \n        }else {\n            console.log('弹出取消申请框');\n            this.cancelManageBox.active = true;\n            var str = cc.jajale.enterRoomData.isManage ? '您确定要取消当家状态吗？':'您确定要取消当家申请吗？';\n            this.cancelManageBox.getComponent('cancelManageScript').setHintText(str);\n        }\n        \n\n    },\n    /**\n     * 加 减\n     */\n    onSetGoldHandle: function(event, customData) {\n        if (!cc.jajale.play) {\n            console.log('需要坐下才可以操作');\n            return;\n        }\n        if (cc.jajale.enterRoomData.dragInGold < 100000000) {\n            console.log('带入金币少于当家最低金额');\n            return;\n        }\n        console.log('加 减', customData);\n        switch (customData) {\n            case 'addBtn1':\n                \n                if (this.setManageGold + 10000000 > cc.jajale.enterRoomData.dragInGold) {\n                    console.log('当家金额不能大于携带的金币数量');\n                    return;\n                }else {\n                    this.setManageGold += 10000000;\n                }\n                \n                break;\n            case 'subBtn1':\n                if (this.setManageGold - 10000000 < 100000000) {\n                    console.log('当家金额不能低于1亿');\n                    return;\n                }else {\n                    this.setManageGold -= 10000000;\n                }\n                break;\n            case 'addBtn2':\n                if (this.setCompensateGold + 10000000 > this.setManageGold) {\n                    console.log('赔付金额不能大于当家金额');\n                    return;\n                }else {\n                    this.setCompensateGold += 10000000;\n                }\n                break;\n            case 'subBtn2':\n                if (this.setCompensateGold - 10000000 < this.setManageGold * 0.2) {\n                    console.log('赔付金额不能低于当家金币的20%');\n                    return;\n                }else {\n                    this.setCompensateGold -= 10000000;\n                }\n                break;\n        \n            default:\n                break;\n        }\n\n        this.setManageGoldLab.string = ttqp_global.unitConversion(this.setManageGold);\n        this.setCompensateGoldLab.string = ttqp_global.unitConversion(this.setCompensateGold);\n    },\n    /**\n     * 自动排队\n     */\n    onZDPDHandle: function() {\n        if (!cc.jajale.play) {\n            console.log('需要坐下才可以操作');\n            return;\n        }\n        console.log('自动排队');\n        if (this.manageRoleIdArr.indexOf(ttqp_global.currentUserInfo.roleId) == -1) {\n            console.log('您没有在申请当家列表中');\n        }else {\n            // 排队\n            cc.scn.socket.send(112209,{'isAutoList' : !this.isAutoApplyFor});\n        }\n    },\n     /**\n     * 当家玩家列表 回调\n     */\n    jajaleManagePlayerListMessage: function(data) {\n\n        console.log('当家列表',data);\n        var self = this; \n        this.manageRoleIdArr = [];\n        this.manageListContentView.removeAllChildren();\n\n        this.isAutoApplyFor = data.isAutoList;\n\n        var file = \"textures/jajale/manage/jajale-sqdj\";\n        var zdpdText = this.isAutoApplyFor ? 'draw1' : 'draw2';\n        cc.loader.loadRes(file, cc.SpriteAtlas, function (err, atlas) {\n            var frame = atlas.getSpriteFrame(zdpdText);\n            self.zdpdIcon.spriteFrame = frame;\n        });\n\n        var list = data.bossList;\n        for (let index = 0; index < list.length; index++) {\n            var item = cc.instantiate(this.managePlayerItem);\n            this.manageListContentView.addChild(item);\n            item.getComponent('manageListItemScript').initManageListItem(list[index]);\n            this.manageRoleIdArr.push(list[index].roleId);\n            \n        }\n        setTimeout(() => {\n            console.log('id 列表',this.manageRoleIdArr)\n            if (this.manageRoleIdArr.indexOf(ttqp_global.currentUserInfo.roleId) != -1) {\n                // 当前用户已在排队列表\n                cc.loader.loadRes(file, cc.SpriteAtlas, function (err, atlas) {\n                    \n                    var frame = atlas.getSpriteFrame('qxdj');\n                    self.sqdjIcon.spriteFrame = frame;\n                });\n            }else {\n                cc.loader.loadRes(file, cc.SpriteAtlas, function (err, atlas) {\n                    \n                    var frame = atlas.getSpriteFrame('sqdj');\n                    self.sqdjIcon.spriteFrame = frame;\n                });\n            }\n        }, 0);\n    },\n    /**\n     * 申请当家 回调\n     */\n    jajaleApplyForManageMessage: function(data) {\n\n        // 获取当家列表 roomType:(int) 是1百家厅，2是朋友厅\n        cc.scn.socket.send(112208,{'roomType': cc.jajale.enterRoomData.roomType});\n\n        this.sqdjIcon.spriteFrame = new cc.SpriteFrame(cc.url.raw(\"resources/textures/jajale/manage/jajale-sqdj.plist/qxdj.png\"));\n    },\n    /**\n     * 自动排队 回调\n     */\n    jajaleAutoQueueMessage: function(data) {\n\n        var self = this; \n\n        this.isAutoApplyFor = data.isAutoList;\n\n        var file = \"textures/jajale/manage/jajale-sqdj\";\n        var zdpdText = this.isAutoApplyFor ? 'draw1' : 'draw2';\n        cc.loader.loadRes(file, cc.SpriteAtlas, function (err, atlas) {\n            var frame = atlas.getSpriteFrame(zdpdText);\n            self.zdpdIcon.spriteFrame = frame;\n        });\n    },\n    \n});\n"]}