{"version":3,"sources":["HomeSignInShowView.js"],"names":["signInConfigData","require","cc","Class","extends","Component","properties","contentView","Node","getAwardBtn","getAwardBtnSpFrames","SpriteFrame","dayItems","getAwardShowViewPrefab","Prefab","onLoad","waitSignInIdx","self","node","getComponent","onClickLightGrayBg","onShowView","signInDataList","callback","onfire","on","getSignInData","bind","getAwardShowView","instantiate","addChild","configUseBtnSPF","onConfigUI","signInList","isHaveGetAward","i","length","dayItem","signInData","status","init","isNotClick","normalSprite","pressedSprite","button","Button","onGetAwardBtnClick","isShow","active","moveAction","moveTo","p","runAction","onGetSignInData","setPositionY","scn","socket","send","onSignIn","getSignInCallback","data","signList","onSignInDataConfig","console","log","currentSignInItemData","gold","toString","push","onCloseBtnClick","event"],"mappings":"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","file":"HomeSignInShowView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomeSignInShowView","sourcesContent":["var signInConfigData = require('signIn');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 子控件的背景View\n        contentView: cc.Node,\n\n        // 签到领取按钮\n        getAwardBtn: cc.Node,\n        getAwardBtnSpFrames: [cc.SpriteFrame],\n\n        // 每天签到的item\n        dayItems: [cc.Node],\n\n        // 签到领取时，弹出礼物弹窗\n        getAwardShowViewPrefab: cc.Prefab,\n    },\n\n    onLoad () {\n        this.waitSignInIdx = -1;\n        var self = this;\n        this.node.getComponent('HomeSyncClickBgNode').onClickLightGrayBg(() => {\n            self.onShowView(false, self.signInDataList, self.callback);\n        });\n        \n        onfire.on(\"SignInDataHandle\",this.getSignInData.bind(this));\n\n        // 初始化弹窗\n        this.getAwardShowView = cc.instantiate(this.getAwardShowViewPrefab);\n        this.getAwardShowView.getComponent('HomeGiftFetchView').onShowView(false, \"+0\", null);\n        this.node.addChild(this.getAwardShowView);\n\n        this.configUseBtnSPF(false);\n    },\n\n    // 配置本类UI\n    onConfigUI(signInList) {\n\n        let isHaveGetAward = false;\n        for (let i = 0; i < signInList.length; i++) {\n            const dayItem = this.dayItems[i];\n            const signInData = signInList[i];\n            \n            if (signInData.status == \"1\") {\n                isHaveGetAward = true;\n                this.waitSignInIdx = i;\n            }\n            dayItem.getComponent('HomeSignInItem').init(signInData);\n        }\n        \n        this.waitSignInIdx = isHaveGetAward ? this.waitSignInIdx : -1;\n        this.configUseBtnSPF(isHaveGetAward);\n    },\n\n    // 配置 领取 按钮的背景图片\n    configUseBtnSPF(isNotClick) {\n        var normalSprite = null;\n        var pressedSprite = null;\n        if (isNotClick) {\n            normalSprite = this.getAwardBtnSpFrames[0];\n            pressedSprite = this.getAwardBtnSpFrames[1];\n        } else {\n            normalSprite = this.getAwardBtnSpFrames[2];\n            pressedSprite = this.getAwardBtnSpFrames[2];\n        }\n        var button = this.getAwardBtn.getComponent(cc.Button);\n        button.normalSprite = normalSprite;\n        button.pressedSprite = pressedSprite;\n        this.getAwardBtn.on('click', this.onGetAwardBtnClick, this);\n    },\n\n    /**\n     * 弹出/关闭 窗口\n     * @param {是否弹出} isShow           \n     * @param {回调函数，在点击使用的时候回调} callback \n     */\n    onShowView(isShow, callback) {\n        this.callback = callback;\n\n        this.node.active = isShow;\n        if (isShow) {\n            var moveAction = cc.moveTo(0.2, cc.p(0, 0));\n            this.contentView.runAction(moveAction);\n\n            // 获取签到数据\n            this.onGetSignInData();\n        } else {\n            this.contentView.setPositionY(-1300);\n        }\n    },\n\n\n    /****************************************  本类接口相关  ****************************************/\n    // 获取签到数据\n    onGetSignInData() {\n        cc.scn.socket.send(10601);\n    },\n    // 当天签到接口\n    onSignIn() {\n        onfire.on(\"SignInHandle\",this.getSignInCallback.bind(this));\n        cc.scn.socket.send(10602);\n    },\n\n    /****************************************  本类接口回调相关  ****************************************/\n    // 获取服务器返回的签到信息\n    getSignInData(data) {\n        if (!data || !data.signList) return;\n        this.onSignInDataConfig(data.signList);\n    },\n    // 发送签到接口后信息回调\n    getSignInCallback(data) {\n        console.log(\"签到成功了\");\n        if (!data || !data.signList) return;\n        this.onSignInDataConfig(data.signList);\n\n        let currentSignInItemData = null;\n        for (let i = 0; i < data.signList.length; i++) {\n            if (data.signList[i] != 2) {\n                currentSignInItemData = this.signInDataList[i - 1];\n                break;\n            }\n        }\n\n        var self = this;\n        let gold = '+' + currentSignInItemData.gold;\n        this.getAwardShowView.getComponent('HomeGiftFetchView').onShowView(true, gold.toString(), ()=>{\n        });\n    },\n\n    // 处理 签到接口/获取签到数据接口 返回的数据\n    onSignInDataConfig(signInData) {\n        var signInDataList = [];\n        console.log(\"signInData == \" + signInData);\n        \n        for (let i = 0; i < signInData.length; i++) {\n            signInDataList.push({\n                \"status\": signInData[i].toString(),\n                \"gold\": signInConfigData[i].gold.toString(),\n            });\n        }\n        \n        this.signInDataList = signInDataList;\n        if (signInDataList && signInDataList.length == 7) {\n            this.onConfigUI(signInDataList);\n        }\n    },\n\n    /****************************************  本类事件监听  ****************************************/\n    /// 关闭按钮的点击\n    onCloseBtnClick(event) {\n        this.onShowView(false, this.signInDataList, this.callback);\n    },\n\n    /// 点击领取弹窗\n    onGetAwardBtnClick(event) {\n        if (this.waitSignInIdx == -1) return;\n        this.onSignIn();\n    },\n});\n"]}