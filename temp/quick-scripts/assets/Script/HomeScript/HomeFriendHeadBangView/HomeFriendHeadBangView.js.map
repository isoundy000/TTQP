{"version":3,"sources":["HomeFriendHeadBangView.js"],"names":["socket","require","cc","Class","extends","Component","properties","scrollView","ScrollView","scrollContent","Node","friendHeadItem","Prefab","addFriendView","rankingListView","onLoad","page","onfire","on","onFriendRequestHandle","bind","onOnlineStatusHandle","onRefreshHandle","scrollViewEventHandler","EventHandler","target","node","component","handler","scroll","getComponent","scrollEvents","push","onGetFriendData","onCreateFriendItem","self","removeAllChildren","i","friendList","length","friendData","isFriend","item","instantiate","init","userInfo","addChild","scn","isInCurent","params","send","data","concat","onAddFriendBtnClick","event","onShowView","onFriendLoadMoreHandle","scrollview","eventType","EventType","BOUNCE_BOTTOM","BOUNCE_TOP","onShowRankingListBtnClick","isDetailList"],"mappings":"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","file":"HomeFriendHeadBangView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomeFriendHeadBangView","sourcesContent":["var socket = require(\"websocketScript\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scrollView: cc.ScrollView,\n        scrollContent: cc.Node,\n        friendHeadItem: cc.Prefab,\n\n        // 添加好友弹窗\n        addFriendView: cc.Node,\n        // 弹出排行榜弹窗\n        rankingListView: cc.Node,\n    },\n\n    onLoad () {\n\n        this.page = 0;\n\n        onfire.on(\"HomeFriendListHandle\",this.onFriendRequestHandle.bind(this));\n        onfire.on(\"HomeFriendOnlineStatusHandle\",this.onOnlineStatusHandle.bind(this));\n        onfire.on(\"HomeRefreshFriendListHandle\",this.onRefreshHandle.bind(this));\n\n        // 给滑动视图view 添加上拉加载功能操作\n        var scrollViewEventHandler = new cc.Component.EventHandler();\n        scrollViewEventHandler.target = this.node; //这个 node 节点是你的事件处理代码组件所属的节点\n        scrollViewEventHandler.component = \"HomeFriendHeadBangView\";//这个是代码文件名\n        scrollViewEventHandler.handler = \"onFriendLoadMoreHandle\";// 触发上拉加载回调\n        var scroll = this.scrollView.getComponent(cc.ScrollView);\n        scroll.scrollEvents.push(scrollViewEventHandler);\n\n        this.onGetFriendData();\n    },\n\n    // 创建Item\n    onCreateFriendItem() {\n        let self = this;\n        \n        this.scrollContent.removeAllChildren();\n\n        for (let i = 0; i < this.friendList.length; i++) {\n            let friendData = this.friendList[i];\n            friendData.isFriend = \"1\";\n\n            let item = cc.instantiate(this.friendHeadItem);\n            item.getComponent('HomeBangHeadItem').init(friendData, (userInfo)=> {\n                //\n                // self.userInfoView.getComponent('HomeFriendShowView').onShowView(true, userInfo);\n            });\n            this.scrollContent.addChild(item);\n        }\n    },\n\n    /****************************************  本类发送接口相关  ****************************************/\n    // 获取好友列表\n    onGetFriendData() {\n        if (!cc.scn || !cc.scn.socket) return;\n        this.isInCurent = true;\n        var params = {\n            \"page\": this.page\n        };\n        cc.scn.socket.send(10702, params);\n    },\n    /****************************************  本类接口响应回调  ****************************************/\n    // 好友列表接口回调\n    onFriendRequestHandle(data) {\n        if (!this.isInCurent) return;\n        this.isInCurent = false;\n        \n        if (this.page == 0) {\n            this.friendList = data.friendList;\n        } else {\n            this.friendList = this.friendList.concat(data.friendList);\n        }\n        \n        this.page += 1;\n        this.onCreateFriendItem();\n    },\n    // 好友上下线接口回调\n    onOnlineStatusHandle(data) {\n        this.page = 0;\n        this.onGetFriendData();\n    },\n    // 好友列表数据变化接口回调\n    onRefreshHandle(data) {\n        this.page = 0;\n        this.onGetFriendData();\n    },\n\n    /****************************************  本类事件监听  ****************************************/\n    // 添加好友按钮\n    onAddFriendBtnClick(event) {\n\n        // 弹出添加好友弹窗\n        this.addFriendView.getComponent('HomeAddFriendView').onShowView(true, \"\", () => {\n            //\n        });\n    },\n\n    /**\n     * 滑动视图 ScrollView 的上拉加载\n     */\n    onFriendLoadMoreHandle(scrollview, eventType) {\n        if (eventType === cc.ScrollView.EventType.BOUNCE_BOTTOM) {\n            this.onGetFriendData();\n        } else if (eventType === cc.ScrollView.EventType.BOUNCE_TOP) {\n            this.page = 0;\n            this.onGetFriendData();\n        }\n    },\n\n    /**\n     * 弹出排行榜\n     */\n    onShowRankingListBtnClick(event) {\n        this.isDetailList = true;\n        let self = this;\n        this.rankingListView.getComponent('HomeRankingListView').onShowView(true, ()=> {\n            self.isDetailList = false;\n        });\n    },\n\n});\n"]}