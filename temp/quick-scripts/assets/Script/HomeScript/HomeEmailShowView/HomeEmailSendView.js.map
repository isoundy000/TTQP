{"version":3,"sources":["HomeEmailSendView.js"],"names":["socket","require","cc","Class","extends","Component","properties","contentView","Node","nameEditBox","EditBox","contentEditBox","goldEditBox","typeIdx","typeNode","typeAlertBgView","typeSpFrames","SpriteFrame","alertViewPrefab","Prefab","alertUserViewPrefab","onLoad","self","node","getComponent","onClickLightGrayBg","onShowView","alertUserView","instantiate","addChild","active","alertViewItem","alertView","onfire","on","onGetUserData","bind","sendEmailBlock","onConfigUI","roleId","string","length","fromID","toString","count","i","Sprite","spriteFrame","isShow","callback","moveAction","moveTo","p","runAction","setPositionY","onSendEmailRequest","params","scn","send","data","console","log","JSON","stringify","paramsData","gold","typeName","id","toRoleId","onShowTypeBgBtnClick","event","onTypeBtnClick","customData","parseInt","onSendBtnClick","name","content","parseFloat","ttqp_global","currentUserInfo"],"mappings":"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","file":"HomeEmailSendView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomeEmailShowView","sourcesContent":["var socket = require(\"websocketScript\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 子控件的背景View\n        contentView: cc.Node,\n        nameEditBox: cc.EditBox,\n        contentEditBox: cc.EditBox,\n        goldEditBox: cc.EditBox,\n\n        typeIdx: 0,\n        typeNode: cc.Node,\n        typeAlertBgView: cc.Node,\n        typeSpFrames: [cc.SpriteFrame],\n\n        alertViewPrefab: cc.Prefab,\n        // 带有金币邮件的发送确认窗口\n        alertUserViewPrefab: cc.Prefab,\n    },\n\n    onLoad() {\n        var self = this;\n        this.node.getComponent('HomeSyncClickBgNode').onClickLightGrayBg(() => {\n            self.onShowView(false);\n        });\n\n        // 创建 带有金币邮件的发送确认窗口\n        this.alertUserView = cc.instantiate(this.alertUserViewPrefab);\n        this.node.addChild(this.alertUserView);\n        this.alertUserView.getComponent('HomeAlertUserView').node.active = false;\n\n        // 创建警告框\n        let alertViewItem = cc.instantiate(this.alertViewPrefab);\n        this.alertView = alertViewItem.getComponent('HomeAlertView');\n        this.node.addChild(alertViewItem)\n        this.alertView.onShowView(false, false, \"\", null);\n\n        // 获取接收用户信息接口\n        onfire.on(\"EmailUserDataHandle\", this.onGetUserData.bind(this));\n        // 定义发送邮件回调函数\n        onfire.on(\"EmailSendHandle\", this.sendEmailBlock.bind(this));\n    },\n\n    onConfigUI(roleId) {\n        this.nameEditBox.string = \"\";\n        if (roleId.length > 0) {\n            // 格式化收件人ID\n            var fromID = roleId.toString();\n            var count = 6 - fromID.length;\n            for (let i = 0; i < count; i++) {\n                fromID = \"0\" + fromID;\n            }\n            this.nameEditBox.string = fromID;\n        }\n\n        this.contentEditBox.string = \"\";\n        this.goldEditBox.string = \"\";\n        this.typeIdx = 0;\n        this.typeAlertBgView.active = false;\n        this.typeNode.getComponent(cc.Sprite).spriteFrame = this.typeSpFrames[this.typeIdx];\n    },\n\n    /**\n     * 弹出/关闭 窗口\n     * @param {是否弹出} isShow\n     */\n    onShowView(isShow, roleId, callback) {\n        this.roleId = roleId ? roleId.toString() : \"\";\n        this.callback = callback;\n\n        this.node.active = isShow;\n        if (isShow) {\n            var moveAction = cc.moveTo(0.2, cc.p(0, 0));\n            this.contentView.runAction(moveAction);\n\n            this.onConfigUI(roleId);\n        } else {\n            this.contentView.setPositionY(-1300);\n        }\n    },\n\n    /****************************************  本类接口回调相关  ****************************************/\n    // 发送邮件，因为写这里，不是写在邮件的js中，是因为外边也有直接发邮件的操作，比如点击好友后发邮件\n    onSendEmailRequest(params) {\n        cc.scn.socket.send(10302, params);\n    },\n\n    /*********************** 本类接口回调相关  **********************/\n    // 发送邮件接口回调函数\n    sendEmailBlock(data) {\n        console.log(\"邮件发送成功！\" + data);\n    },\n\n    onGetUserData(data) {\n        if (!data || data.length == 0) {\n            console.log(\"用户不存在\");\n            return;\n        }\n        console.log(\"[[[[[[[[[[[[[[[[[[[[[[[[[[[[data == \" + JSON.stringify(data));\n        \n        if (this.paramsData) {\n            let gold = this.goldEditBox.string;\n            let typeName = this.typeIdx == 0 ? \"万\" : \"亿\";\n            data.id = this.paramsData.toRoleId;\n            data.gold = gold + typeName;\n            var self = this;\n            this.alertUserView.getComponent('HomeAlertUserView').onShowView(true, data, () => {\n                self.onSendEmailRequest(self.paramsData);\n                self.onShowView(false, this.roleId, this.callback);\n            });\n        }\n    },\n\n    /****************************************  本类事件监听  ****************************************/\n    /**\n     * 弹出 亿、万 类型按钮\n     */\n    onShowTypeBgBtnClick(event) {\n        this.typeAlertBgView.active = !this.typeAlertBgView.active;\n    },\n    /**\n     * 类型按钮的点击\n     */\n    onTypeBtnClick(event, customData) {\n        this.typeIdx = parseInt(customData);\n        this.typeNode.getComponent(cc.Sprite).spriteFrame = this.typeSpFrames[this.typeIdx];\n        this.typeAlertBgView.active = false;\n    },\n\n    /** \n     * 发送按钮\n     */\n    onSendBtnClick(event) {\n        let name = this.nameEditBox.string ? this.nameEditBox.string : \"\";\n        let content = this.contentEditBox.string ? this.contentEditBox.string : \"\";\n        let gold = this.goldEditBox.string ? this.goldEditBox.string : \"\";\n\n        var self = this;\n        if (name.length == 0) {\n            this.alertView.onShowView(true, false, '请输入收件人的ID或昵称', null);\n        } else if (content.length == 0) {\n            this.alertView.onShowView(true, false, '请输入发送内容', null);\n        } else {\n            if (gold.length > 0 && parseFloat(gold) > 0) {\n                if (this.typeIdx == 0) {\n                    if (parseFloat(gold) < 100) {\n                        this.alertView.onShowView(true, false, '一次最少100万才能发送', null);\n                    } else if (parseFloat(gold) > 10000000) {\n                        this.alertView.onShowView(true, false, '一次最多发送100亿', null);\n                    } else {\n                        this.paramsData = {\n                            \"gold\": parseInt(parseFloat(gold) * 10000),\n                            \"toRoleId\": name,\n                            \"content\": content,\n                            \"ID\": ttqp_global.currentUserInfo.roleId.toString(),\n                        }\n                        // 带有金币的时候，需要获取用户信息\n                        cc.scn.socket.send(10307, { \"roleId\": parseInt(name) });\n                    }\n                } else {\n                    if (parseFloat(gold) < 0.0001) {\n                        this.alertView.onShowView(true, false, '一次最少100万才能发送', null);\n                    } else if (parseFloat(gold) > 100) {\n                        this.alertView.onShowView(true, false, '一次最多发送100亿', null);\n                    } else {\n\n                        this.paramsData = {\n                            \"gold\": parseInt(parseFloat(gold) * 100000000),\n                            \"toRoleId\": name,\n                            \"content\": content,\n                            \"ID\": ttqp_global.currentUserInfo.roleId.toString(),\n                        };\n                        cc.scn.socket.send(10307, { \"roleId\": parseInt(name) });\n                    }\n                }\n            } else {\n                this.onSendEmailRequest({\n                    \"gold\": 0,\n                    \"toRoleId\": name,\n                    \"content\": content,\n                    \"ID\": ttqp_global.currentUserInfo.roleId.toString(),\n                });\n                this.onShowView(false, this.roleId, this.callback);\n            }\n        }\n    },\n\n});\n"]}