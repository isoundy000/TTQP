{"version":3,"sources":["HomePackView.js"],"names":["shop_icon_configs","require","cc","Class","extends","Component","properties","contentView","Node","scrollContent","shopItem","Prefab","shop_namelabel","Label","shop_num_label","shop_intro_label","shop_time_label","shopSpFrames","SpriteFrame","useBtn","useBtnSpFrames","onLoad","self","node","getComponent","onClickLightGrayBg","onShowView","pack_shop_list","string","onfire","on","onGetPackData","bind","onPackUseShopData","onConfigUI","configUseBtnSPF","length","removeAllChildren","i","item","instantiate","addChild","tag","onClickItem","itemData","init","onGetIconConfigData","giftId","isNotClick","normalSprite","pressedSprite","button","Button","onUseBtnClick","itemGiftId","iconConfigData","shop_iconData","toString","id","isShow","active","moveAction","moveTo","p","runAction","onRequestForPackData","setPositionY","scn","socket","send","onRequestForUseShopData","currentItemDic","currentItemClickIdx","parseInt","console","log","data","nums","splice","onCloseBtnClick","event","currentTarget","name","des","date","Date","pastTime","getFullYear","getMonth","getDate"],"mappings":"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","file":"HomePackView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomePackView","sourcesContent":["let shop_icon_configs = require('Item');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 子控件的背景View\n        contentView: cc.Node,\n        // 滑动视图控制器的content节点\n        scrollContent: cc.Node,\n        // 商品item\n        shopItem: cc.Prefab,\n\n        //-------------- 商品介绍控件 -------------\n        // 商品名称\n        shop_namelabel: cc.Label,\n        // 商品个数\n        shop_num_label: cc.Label,\n        // 商品用途\n        shop_intro_label: cc.Label,\n        // 有效期\n        shop_time_label: cc.Label,\n        // 商品图标数组\n        shopSpFrames: [cc.SpriteFrame],\n        // 使用道具按钮\n        useBtn: cc.Node,\n        useBtnSpFrames: [cc.SpriteFrame],\n    },\n\n    onLoad() {\n        var self = this;\n        this.node.getComponent('HomeSyncClickBgNode').onClickLightGrayBg(() => {\n            self.onShowView(false, self.pack_shop_list);\n        });\n\n        this.shop_namelabel.string = '';\n        this.shop_num_label.string = '';\n        this.shop_intro_label.string = \"\";\n        this.shop_time_label.string = '有效期至：';\n\n        onfire.on(\"PackDataHandle\",this.onGetPackData.bind(this));\n        onfire.on(\"PackUseShopHandle\",this.onPackUseShopData.bind(this));\n    },\n\n    /** 配置/创建Item\n     */\n    onConfigUI() {\n\n        this.configUseBtnSPF(this.pack_shop_list == null || this.pack_shop_list.length == 0);\n\n        // 移除掉所有的item\n        this.scrollContent.removeAllChildren();\n\n        if (this.pack_shop_list == null || this.pack_shop_list.length == 0) {\n\n            this.shop_namelabel.string = '';\n            this.shop_num_label.string = '';\n            this.shop_intro_label.string = \"\";\n            this.shop_time_label.string = '有效期至：';\n\n            return;\n        }\n\n        // 创建item\n        for (var i = 0; i < this.pack_shop_list.length; i++) {\n            var item = cc.instantiate(this.shopItem);\n            this.scrollContent.addChild(item);\n\n            item.tag = i;\n            item.on('click', this.onClickItem, this);\n\n            var itemData = this.pack_shop_list[i];\n            item.getComponent(\"HomePackShopItem\").init(itemData, this.onGetIconConfigData(itemData.giftId));\n            if (i == 0) {\n                this.onClickItem(null);\n            }\n        }\n    },\n\n    configUseBtnSPF(isNotClick) {\n        var normalSprite = null;\n        var pressedSprite = null;\n        if (!isNotClick) {\n            normalSprite = this.useBtnSpFrames[0];\n            pressedSprite = this.useBtnSpFrames[1];\n        } else {\n            normalSprite = this.useBtnSpFrames[2];\n            pressedSprite = this.useBtnSpFrames[2];\n        }\n        var button = this.useBtn.getComponent(cc.Button);\n        button.normalSprite = normalSprite;\n        button.pressedSprite = pressedSprite;\n        this.useBtn.on('click', this.onUseBtnClick, this);\n    },\n\n    /**\n     * 从配置文件中获取商品图标基本信息\n     */\n    onGetIconConfigData(itemGiftId) {\n        var iconConfigData = null;\n        for (let i = 0; i < shop_icon_configs.length; i++) {\n            const shop_iconData = shop_icon_configs[i];\n            if (itemGiftId.toString() == shop_iconData.id.toString()) {\n                iconConfigData = shop_iconData;\n                break;\n            }\n        }\n        return iconConfigData;\n    },\n\n    /**\n     * 弹出/关闭 窗口\n     * @param {是否弹出} isShow          \n     */\n    onShowView(isShow) {\n        this.node.active = isShow;\n        if (isShow) {\n            var moveAction = cc.moveTo(0.2, cc.p(0, 0));\n            this.contentView.runAction(moveAction);\n\n            // 发送接口，获取当前用户背包数据\n            this.onRequestForPackData();\n        } else {\n            this.contentView.setPositionY(-1300);\n        }\n    },\n\n    /****************************************  本类发送接口相关  ****************************************/\n    // 发送获取背包数据接口\n    onRequestForPackData() {\n        cc.scn.socket.send(10501, {});\n    },\n\n    // 发送 使用道具 接口\n    onRequestForUseShopData() {\n\n        var currentItemDic = this.pack_shop_list[this.currentItemClickIdx];\n        if (parseInt(currentItemDic.giftId) == 10) {\n            console.log(\"使用喇叭的时候要跳转到哪里去输入广播的文字 ====== \");\n        } else {\n            cc.scn.socket.send(10502, {\n                \"giftId\": parseInt(currentItemDic.giftId),\n                \"context\": \"\"\n            });\n        }\n    },\n\n\n    /****************************************  本类接口响应回调  ****************************************/\n    // 获取背包数据接口回调\n    onGetPackData(data) {\n        if (!data || data.length == 0) return;\n        this.pack_shop_list = data;\n        this.onConfigUI();\n    },\n\n    // 使用道具 接口回调\n    onPackUseShopData(data) {\n        console.log(\"使用商品回调 === \" + data);\n        \n        var currentItemDic = this.pack_shop_list[this.currentItemClickIdx];\n        if (parseInt(currentItemDic.nums) > 1) {\n\n            currentItemDic.nums = (parseInt(currentItemDic.nums) - 1).toString();\n            this.shop_num_label.string = currentItemDic.nums;\n\n            this.pack_shop_list[this.currentItemClickIdx] = currentItemDic;\n        } else {\n            this.pack_shop_list.splice(this.currentItemClickIdx, 1);\n            this.currentItemClickIdx = 0;\n            this.onConfigUI();\n        } \n    },\n\n    /****************************************  本类事件监听  ****************************************/\n\n    /**\n     * 关闭按钮的点击\n     */\n    onCloseBtnClick(event) {\n        this.onShowView(false, this.pack_shop_list);\n    },\n\n    /**\n     * item的点击\n     */\n    onClickItem(event) {\n\n        var currentItemClickIdx = event ? event.currentTarget.tag : 0;\n        this.currentItemClickIdx = currentItemClickIdx;\n\n        var itemData = this.pack_shop_list[currentItemClickIdx];\n        var iconConfigData = this.onGetIconConfigData(itemData.giftId);\n        this.shop_namelabel.string = iconConfigData.name;\n        this.shop_num_label.string = itemData.nums;\n        this.shop_intro_label.string = iconConfigData.des;\n\n        var date = new Date(itemData.pastTime);\n        this.shop_time_label.string = '有效期至：' + date.getFullYear() + \"-\" + (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1).toString() + '-' + date.getDate().toString();\n    },\n\n    /** 使用商品的按钮点击\n     */\n    onUseBtnClick(event) {\n        if (this.pack_shop_list == null || this.pack_shop_list.length == 0) return;\n        this.onRequestForUseShopData();\n    },\n});\n"]}