{"version":3,"sources":["../../../../../assets/Script/jajaleScript/assets/Script/jajaleScript/jajaleSelectScript.js"],"names":["socket","require","roomData","jajaleState","cc","Class","extends","Component","properties","pytBox","Node","onLoad","jajale","onfire","on","enterTheRoomMessage","bind","jajaleGameStateMessage","statusArr","onSelectJajaleType","event","customData","console","log","params","scn","send","active","onClose","self","onclose","connect","data","ttqp_global","currentUserData","token","currentUserInfo","roleId","node","_parent","status","enterRoomData","betTime","timestamp","time","d","Date","date","getSeconds","countdown","betChipNum","play","director","loadScene","jajaleCountdown","interval","setInterval","clearInterval"],"mappings":"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","file":"jajaleSelectScript.js","sourceRoot":"../../../../../assets/Script/jajaleScript","sourcesContent":["var socket = require(\"websocketScript\");\nvar roomData = require(\"jajaleRoomDataScript\");\nvar jajaleState = require(\"jajaleState\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n       \n        // 好友厅层\n        pytBox: cc.Node,\n        \n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\n        cc.jajale = {};\n        // 从大厅切换到游戏\n        // cc.scn.socket.send(9000,{'sId': -1});\n        // cc.scn.socket.socket.onclose();\n        // cc.scn.socket.socket = {};\n        // cc.scn.socket = socket.connect('jajale');\n\n        // 进入房间\n        onfire.on(\"enterTheRoomMessage\",this.enterTheRoomMessage.bind(this));\n\n        // 游戏状态\n        onfire.on('jajaleGameStateMessage',this.jajaleGameStateMessage.bind(this));\n        \n        // setTimeout(() => {\n        //     // 登录家家乐\n        //     let params = {\n        //         \"token\": ttqp_global.currentUserData.token,\n        //         \"roleId\": ttqp_global.currentUserInfo.roleId\n        //     };\n        //     cc.scn.socket.send(110101, params);\n        // }, 1000);\n\n        \n\n        this.statusArr = [];\n    },\n\n\n    /**\n     * 选择入口\n     */\n    onSelectJajaleType: function(event, customData) {\n        console.log(customData);\n        \n        if (customData == \"2001\") { \n            \n\n            // 进入房间\n            let params = {\n                /**\n                 * roomId:(int) //房间号, 0：百家场；其它：朋友场的房间号ID\n                 * roomPwd:(string) //加锁密码；百家场则忽略\n                 * enterType:(int)//0百家厅，(朋友厅里用到) 1进入房间，2快速进入或者列表进入\n                 */\n                \"roomId\": 0,\n                \"roomPwd\": '',\n                \"enterType\": 0,\n            };\n            cc.scn.socket.send(112204, params);\n\n            \n        }else if (customData == \"2002\") { \n            \n            cc.scn.socket.send(112201);\n            this.pytBox.active = true;\n        }\n    },\n    /**\n     * 关闭窗口\n     */\n    onClose: function() {\n        // console.log('close');\n        \n        var self = this;\n        \n        // 家家乐返回大厅\n        cc.scn.socket.send(110102);\n\n        // 110102 家家乐返回大厅 成功回调\n        onfire.on(\"jajaleBackLobbyMessage\", function() {\n\n            // 断开 游戏的服务器  连接 大厅的服务器\n            cc.scn.socket.socket.onclose();\n            cc.scn.socket.socket = {};\n            cc.scn.socket = socket.connect('home');\n            // 大厅服务器连接成功\n            onfire.on(\"socketOpen\", function(data) {\n                // 返回大厅\n                if (data === 'home') {\n                    let params = {\n                        \"token\": ttqp_global.currentUserData.token,\n                        \"roleId\": ttqp_global.currentUserInfo.roleId\n                    };\n                    cc.scn.socket.send(9001,params);\n                }\n                \n            });\n        });\n\n        // 9001 返回大厅成功 \n        onfire.on(\"backLobbyMessage\", function() {\n            \n            console.log('返回大厅成功');\n            self.node._parent.active = false;\n        });\n\n    },\n    /**\n     * 进入房间接口回调\n     */\n    enterTheRoomMessage: function(data) {\n\n        console.log(data.status, '进入房间成功');\n        \n\n        cc.jajale.enterRoomData = data;\n\n        if (cc.jajale.enterRoomData.betTime != 0 ) {\n            var timestamp = cc.jajale.enterRoomData.time - cc.jajale.enterRoomData.betTime;\n            var d = new Date(timestamp * 1000);    //根据时间戳生成的时间对象\n            var date = d.getSeconds();\n            console.log(date,'98789798');\n            cc.jajale.enterRoomData.countdown = 29 - date;\n        }\n        // 下注默认筹码 1000\n        cc.jajale.enterRoomData.betChipNum = 1000;\n        // 坐下状态\n        cc.jajale.play = false;\n\n\n        \n\n\n        cc.director.loadScene('Jajale');\n\n    },\n    jajaleGameStateMessage: function(data) {\n        \n\n        cc.jajale.enterRoomData.status = data.status;\n\n\n        console.log(cc.jajale.enterRoomData.status, '游戏状态发生改变');\n\n        if (data.status === 2) {\n            var jajaleCountdown = 29;\n            cc.jajale.enterRoomData.countdown = jajaleCountdown;\n            var interval = setInterval(function() {\n                \n                jajaleCountdown--;\n                 \n                if(jajaleCountdown < 1) {\n                    clearInterval(interval);\n                    jajaleCountdown = 0;\n                }\n                cc.jajale.enterRoomData.countdown = jajaleCountdown;\n            }, 1000);\n        }\n\n    },\n    \n});\n"]}