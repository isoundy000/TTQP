{"version":3,"sources":["../../../../../../assets/Script/HomeScript/HomeEmailShowView/assets/Script/HomeScript/HomeEmailShowView/HomeEmailDetailView.js"],"names":["socket","require","cc","Class","extends","Component","properties","contentView","Node","nameLabel","Label","contentLabel","goldBgNode","goldLabel","getBtn","showGetViewPrefab","Prefab","friendBtnBg","addFriendBtnBg","normalBtnBg","alertViewPrefab","onLoad","self","node","getComponent","onClickLightGrayBg","onShowView","emailData","callback","showGetView","instantiate","addChild","alertViewItem","alertView","onfire","on","emailGetGiftBlock","bind","dealFriendHandle","onConfigUI","string","nickname","content","gold","toString","length","active","parseInt","onStatus","isRec","isFriend","friendType","isShow","moveAction","moveTo","p","runAction","setPositionY","onGetEmailGiftRequest","params","mailId","scn","send","onAddFriendRequest","isAgree","data","onAnswerBtnClick","event","onDelBtnClick","onGetBtnClick","onAgreeBtnClick","console","log","onRefusedBtnClick"],"mappings":"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","file":"HomeEmailDetailView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomeEmailShowView","sourcesContent":["// 发接口对象\nvar socket = require(\"websocketScript\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 子控件的背景View\n        contentView: cc.Node,\n\n        nameLabel: cc.Label,\n        contentLabel: cc.Label,\n\n        goldBgNode: cc.Node,\n        goldLabel: cc.Label,\n        getBtn: cc.Node,\n        \n        // 领取金币成功后的弹窗提示 Prefab\n        showGetViewPrefab: cc.Prefab,\n\n        // 底下按钮的的背景View --------\n        // 好友邮件的详情显示的按钮\n        friendBtnBg: cc.Node,\n        // 系统邮件之添加好友申请  的详情显示的按钮背景View\n        addFriendBtnBg: cc.Node,\n        // 系统邮件之普通显示  的详情显示的按钮背景View\n        normalBtnBg: cc.Node,\n\n        // 删除带有未领取的邮件的弹窗提示\n        alertViewPrefab: cc.Prefab,\n    },\n\n    onLoad() {\n        var self = this;\n        this.node.getComponent('HomeSyncClickBgNode').onClickLightGrayBg(() => {\n            self.onShowView(false, self.emailData, self.callback);\n        });\n\n        // 初始化领取弹窗预制资源\n        this.showGetView = cc.instantiate(this.showGetViewPrefab);\n        this.showGetView.getComponent('HomeGiftFetchView').onShowView(false, \"+0\", null);\n        this.node.addChild(this.showGetView);\n        \n        // 初始化警告框\n        let alertViewItem = cc.instantiate(this.alertViewPrefab);\n        this.alertView = alertViewItem.getComponent('HomeAlertView');\n        this.node.addChild(alertViewItem)\n        this.alertView.onShowView(false, false, \"\", null);\n\n\n        // 领取附件\n        onfire.on(\"EmailGetGiftHandle\", this.emailGetGiftBlock.bind(this));\n        onfire.on(\"EmailDealFriendHandle\", this.dealFriendHandle.bind(this));\n    },\n\n    /**\n     * 配置本类UI\n     */\n    onConfigUI() {\n\n        this.nameLabel.string = this.emailData.nickname;\n        this.contentLabel.string = this.emailData.content;\n\n        var gold = this.emailData.gold.toString().length > 0 ? this.emailData.gold.toString() : \"\";\n        this.goldBgNode.active = parseInt(gold) > 0;\n        this.goldLabel.string = gold;\n\n        this.getBtn.getComponent('HomeSelectBtn').onStatus(this.emailData.isRec.toString() != \"0\");\n        \n        // 控制回复按钮的显示与否  回复按钮，只是在好友邮件中才能看到\n        if (this.isFriend) {\n            this.friendBtnBg.active = true;\n            this.addFriendBtnBg.active = false;\n            this.normalBtnBg.active = false;\n        } else {\n            this.friendBtnBg.active = false;\n            if (this.emailData.friendType.toString() == '1') {\n                this.addFriendBtnBg.active = true;\n                this.normalBtnBg.active = false;\n            } else {\n                this.addFriendBtnBg.active = false;\n                this.normalBtnBg.active = true;\n            }\n        }\n    },\n\n    /**\n     * 弹出/关闭 窗口\n     * @param {是否弹出} isShow\n     * @param {是否是 好友邮件 } isFriend\n     * @param {邮件数据} emailData\n     * @param {邮件回调} callback\n     */\n    onShowView(isShow, isFriend, emailData, callback) {\n        this.isFriend = isFriend;\n        this.emailData = emailData;\n        this.callback = callback;\n\n        this.node.active = isShow;\n        if (isShow) {\n            var moveAction = cc.moveTo(0.2, cc.p(0, 0));\n            this.contentView.runAction(moveAction);\n\n            this.onConfigUI();\n        } else {\n            this.contentView.setPositionY(-1300);\n        }\n    },\n    /********************************  本类发送接口  ********************************/\n    onGetEmailGiftRequest() {\n        let params = {\n            \"mailId\": this.emailData.mailId\n        };\n        cc.scn.socket.send(10305, params);\n    },\n    onAddFriendRequest(isAgree) {\n        // 发送操作好友申请邮件   isAgree：同意   !isAgree：拒绝\n        this.isAgree = isAgree;\n        let params = {\n            \"mailId\": this.emailData.mailId,\n            \"handle\": isAgree ? 1 : 2,\n        };\n        cc.scn.socket.send(10306, params);\n    },\n\n    /********************************  本类发送接口 回调  ********************************/\n    emailGetGiftBlock(data) {\n        //\n        this.emailData.isRec = 1;\n        this.onConfigUI();\n        this.callback(2, this.emailData);\n        this.showGetView.getComponent('HomeGiftFetchView').onShowView(true, ('+' + this.emailData.gold.toString()), null);\n    },\n    dealFriendHandle(data) {\n        // 同意添加好友请求操作\n        this.emailData.friendType = this.isAgree ? 3 : 2;\n        if (this.callback) {\n            this.callback(3, this.emailData);\n        }\n        this.onConfigUI();\n    },\n\n    /********************************  本类事件监听  ********************************/\n    \n    /**\n     * 回复按钮的点击\n     */\n    onAnswerBtnClick(event) {\n        if (this.callback) {\n            this.callback(0, this.emailData);\n        }\n        this.onShowView(false, this.emailData, this.callback);\n    },\n\n    /**\n     * 删除按钮的点击\n     */\n    onDelBtnClick(event) {\n        var self = this;\n        if (this.emailData.isRec.toString() == \"0\" && this.emailData.gold > 0) {\n\n            this.alertView.onShowView(\n                true, false, '邮件中有未领取的' + this.emailData.gold + '金币，删除邮件后金币会一起删除，您确定删除？', \n                () => {\n                if (self.callback) {\n                    self.callback(1, self.emailData);\n                }\n                self.onShowView(false, self.emailData, self.callback);\n            });\n        } else {\n            if (this.callback) {\n                this.callback(1, this.emailData);\n            }\n            this.onShowView(false, this.emailData, this.callback);\n        }\n    },\n\n    /**\n     * 领取按钮的点击\n     */\n    onGetBtnClick(event) {\n        this.onGetEmailGiftRequest();\n    },\n\n    /**\n     * 好友申请 -> 同意\n     */\n    onAgreeBtnClick(event) {\n        console.log('同意 好友申请');\n        this.onAddFriendRequest(true);\n    },\n\n    /**\n     * 好友申请 -> 拒绝\n     */\n    onRefusedBtnClick(event) {\n        console.log('拒绝 好友申请');\n        this.onAddFriendRequest(false);\n    },\n});\n"]}