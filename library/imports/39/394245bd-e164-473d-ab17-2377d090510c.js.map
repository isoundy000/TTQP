{"version":3,"sources":["../../../../../../assets/Script/HomeScript/HomeSettingView/assets/Script/HomeScript/HomeSettingView/HomeSetUpdatePwdView.js"],"names":["socket","require","cc","Class","extends","Component","properties","contentView","Node","phoneEditBox","EditBox","pwdEditBox","yanzhengmaEditBox","yzmAlertText","Label","maxCount","onLoad","isRunning","currentCountNum","onfire","on","onGetVerCode","bind","onUpdatePwdHandle","onConfigUI","string","onShowView","isShow","callback","setScale","scaleAmin1","scaleTo","scaleAmin2","runAction","sequence","scaleAmin","node","active","onCloseVerCodeTimer","timer","unschedule","onVerCodeRequest","phone","length","console","log","params","scn","send","onUpdatePwd","password","code","data","schedule","onMenusBtnClick","event","customData","itemIdx","parseInt","onCloseBtnClick"],"mappings":"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","file":"HomeSetUpdatePwdView.js","sourceRoot":"../../../../../../assets/Script/HomeScript/HomeSettingView","sourcesContent":["// 发接口对象\nvar socket = require(\"websocketScript\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        contentView: cc.Node,\n\n        /// 手机号输入框\n        phoneEditBox: cc.EditBox,\n        /// 新密码输入框\n        pwdEditBox: cc.EditBox,\n        /// 验证码输入框\n        yanzhengmaEditBox: cc.EditBox,\n\n        /// 验证码的提示标签\n        yzmAlertText: cc.Label,\n        /// 倒计时的最大数\n        maxCount: 60,\n\n    },\n\n    onLoad() {\n        // 是否在倒计时\n        this.isRunning = false;\n        // 当前倒计时的数字\n        this.currentCountNum = this.maxCount;\n\n        // 获取验证码 接口回调 配置\n        onfire.on(\"ProjectGetVerCodeHandle\", this.onGetVerCode.bind(this));\n        onfire.on(\"HomeUpdatePwdHandle\", this.onUpdatePwdHandle.bind(this));\n    },\n\n    onConfigUI() {\n        //\n        this.phoneEditBox.string = \"\";\n        this.pwdEditBox.string = \"\";\n        this.yanzhengmaEditBox.string = \"\";\n    },\n\n    /**\n     * 弹出/关闭 窗口\n     * @param {是否弹出} isShow       \n     * @param {回调函数，在点击使用的时候回调} callback \n     */\n    onShowView(isShow, callback) {\n        this.contentView.setScale(0.8, 0.8);\n        this.callback = callback;\n\n        if (isShow) {\n            var scaleAmin1 = cc.scaleTo(0.000001, 0.8, 0.8);\n            var scaleAmin2 = cc.scaleTo(0.2, 1, 1);\n            this.contentView.runAction(cc.sequence(scaleAmin1, scaleAmin2));\n\n            this.onConfigUI();\n        } else {\n            var scaleAmin = cc.scaleTo(0, 0.8, 0.8);\n            this.contentView.runAction(scaleAmin);\n        }\n        this.node.active = isShow;\n    },\n\n    /**\n     * 关闭获取验证码的倒计时\n     */\n    onCloseVerCodeTimer() {\n        this.isRunning = false;\n        this.yzmAlertText.string = \"获取验证码\";\n        this.currentCountNum = this.maxCount;\n        if (this.timer) {\n            this.unschedule(this.timer);\n        }\n    },\n\n    /*********************** 发送接口 ***********************/\n    onVerCodeRequest() {\n        let phone = this.phoneEditBox.string ? this.phoneEditBox.string : \"\";\n        if (phone.length == 0) {\n            console.log(\"请输入手机号码！\");\n        } else if (phone.length != 11) {\n            console.log(\"请输入正确的手机号码！\");\n        } else {\n            let params = {\n                \"phone\": phone,\n                \"type\": 1\n            };\n            cc.scn.socket.send(10905, params);\n        }\n    },\n\n    /**\n     * 修改密码\n     */\n    onUpdatePwd() {\n\n        let phone = this.phoneEditBox.string ? this.phoneEditBox.string : \"\";\n        let password = this.pwdEditBox.string ? this.pwdEditBox.string : \"\";\n        let code = this.yanzhengmaEditBox.string ? this.yanzhengmaEditBox.string : \"\";\n        \n        if (phone.length != 11) {\n            console.log(\"请输入正确的手机号码\");\n        }else if (code.length != 6) {\n            console.log(\"请输入正确的验证码\");\n        } else if (!(password.length >= 6 && password.length <= 12)) {\n            console.log(\"请输入6-12位数字或英文字母的密码\");\n        } else {\n            let params = {\n                \"pwd\": password,\n                \"code\": code,\n                \"phone\": phone\n            };\n            cc.scn.socket.send(10904, params);\n        }\n    },\n\n    /*********************** 接口回调 ***********************/\n    /**\n     * 获取验证码接口\n     */\n    onGetVerCode(data) {\n        if (this.node.active == false) return;\n        \n        this.isRunning = true;\n        this.yzmAlertText.string = this.currentCountNum + \"s\";\n\n        this.timer = function () {\n            if (this.currentCountNum > 0) {\n                this.currentCountNum--;\n                this.yzmAlertText.string = this.currentCountNum + \"s\";\n            } else {\n                // 关闭获取验证码的定时器\n                this.onCloseVerCodeTimer();\n            }\n        }\n        this.schedule(this.timer, 1)\n    },\n\n    /**\n     * 提交修改密码回调\n     */\n    onUpdatePwdHandle(data) {\n        //\n        console.log(\"修改密码成功\");\n        \n    },\n\n    onMenusBtnClick(event, customData) {\n        let itemIdx = parseInt(customData);\n        switch (itemIdx) {\n            case 0: {   // 确定\n                this.onUpdatePwd();\n            }\n                break;\n            case 1: {   // 取消\n                this.onShowView(false, this.callback);\n                // 关闭获取验证码的定时器\n                this.onCloseVerCodeTimer();\n            }\n                break;\n            case 2: {   // 获取验证码\n                if (!this.isRunning) {\n                    // 发送获取验证码接口\n                    this.onVerCodeRequest();\n                }\n            }\n                break;\n\n            default:\n                break;\n        }\n    },\n\n    /**\n     * 点击关闭按钮\n     */\n    onCloseBtnClick(event) {\n        this.onShowView(false, this.callback);\n        // 关闭获取验证码的定时器\n        this.onCloseVerCodeTimer();\n    },\n});\n"]}